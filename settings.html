<div id="qrf_settings_panel">

    <div class="qrf-header">
        <h4><i class="fas fa-magic"></i> 剧情优化大师 - 设置</h4>
    </div>

    <fieldset class="settings-group">
        <legend><i class="fas fa-cogs"></i> 核心设置</legend>
        <div class="qrf_settings_block">
            <label for="qrf_enabled"><strong>插件总开关</strong></label>
            <label class="toggle-switch">
                <input id="qrf_enabled" type="checkbox" />
                <span class="slider"></span>
            </label>
        </div>
        <div class="qrf_settings_block">
            <label for="qrf_worldbook_enabled">启用世界书</label>
            <label class="toggle-switch">
                <input id="qrf_worldbook_enabled" type="checkbox" />
                <span class="slider"></span>
            </label>
            <small class="notes">开启后，会将角色绑定的世界书内容作为参考信息发送给API。</small>
        </div>
    </fieldset>

    <fieldset class="settings-group">
        <legend><i class="fas fa-network-wired"></i> API与模型配置</legend>

        <div class="qrf_settings_block_radio">
            <label>API访问模式</label>
            <div class="qrf_radio_group">
                <input type="radio" id="qrf_api_mode_backend" name="qrf_api_mode" value="backend" checked>
                <label for="qrf_api_mode_backend">酒馆后端代理</label>
                <input type="radio" id="qrf_api_mode_frontend" name="qrf_api_mode" value="frontend">
                <label for="qrf_api_mode_frontend">前端直连</label>
            </div>
            <small class="notes">推荐使用“酒馆后端代理”以避免CORS跨域问题。仅当你的API服务正确配置了CORS时，才选择“前端直连”。</small>
        </div>

        <div class="qrf_settings_block">
            <label for="qrf_api_url">API URL</label>
            <input id="qrf_api_url" type="text" class="text_pole" placeholder="例如: http://localhost:5001/v1" />
        </div>
        <div class="qrf_settings_block">
            <label for="qrf_api_key">API Key</label>
            <input id="qrf_api_key" type="password" class="text_pole" placeholder="你的API密钥" />
        </div>
        <div class="qrf_settings_block qrf_model_selector_block">
            <label for="qrf_model">模型名称</label>
            <div class="qrf_model_selector_wrapper">
                <select id="qrf_model" class="text_pole"></select>
                <button id="qrf_fetch_models" class="menu_button" title="获取模型列表"><i class="fa-solid fa-cloud-arrow-down"></i></button>
                <button id="qrf_test_api" class="menu_button" title="测试API连接"><i class="fa-solid fa-plug-circle-check"></i></button>
            </div>
             <small class="notes">点击下载图标从API获取可用模型列表，点击插头图标测试连接是否成功。</small>
        </div>
        <div class="qrf_settings_block">
            <label for="qrf_max_tokens">最大Token数: <span id="qrf_max_tokens_value"></span></label>
            <input id="qrf_max_tokens" type="range" min="100" max="64000" step="100" />
        </div>
        <div class="qrf_settings_block">
            <label for="qrf_temperature">温度: <span id="qrf_temperature_value"></span></label>
            <input id="qrf_temperature" type="range" min="0" max="2" step="0.1" />
        </div>
        <div class="qrf_settings_block">
            <label for="qrf_context_turn_count">上下文轮数: <span id="qrf_context_turn_count_value"></span></label>
            <input id="qrf_context_turn_count" type="range" min="0" max="10" step="1" />
        </div>
    </fieldset>

    <fieldset class="settings-group">
        <legend><i class="fas fa-edit"></i> 提示词指令</legend>
        <div class="qrf_settings_block">
            <div class="qrf_label_with_button_wrapper">
                <label for="qrf_main_prompt">主系统提示词 (通用)</label>
                <button id="qrf_reset_main_prompt" class="menu_button qrf_reset_button" title="重置为主提示词"><i class="fa-solid fa-undo"></i></button>
            </div>
            <textarea id="qrf_main_prompt" class="text_pole" rows="3"></textarea>
            <small class="notes">为AI设定一个通用的身份或背景。</small>
        </div>
        <div class="qrf_settings_block">
            <div class="qrf_label_with_button_wrapper">
                <label for="qrf_system_prompt">拦截任务详细指令</label>
                <button id="qrf_reset_system_prompt" class="menu_button qrf_reset_button" title="重置为默认拦截任务"><i class="fa-solid fa-undo"></i></button>
            </div>
            <textarea id="qrf_system_prompt" class="text_pole" rows="8"></textarea>
            <small class="notes">告诉API如何具体地处理用户的输入。</small>
        </div>
        <div class="qrf_settings_block">
             <div class="qrf_label_with_button_wrapper">
                <label for="qrf_final_system_directive">最终注入指令 (Storyteller Directive)</label>
                <button id="qrf_reset_final_system_directive" class="menu_button qrf_reset_button" title="重置为默认注入指令"><i class="fa-solid fa-undo"></i></button>
            </div>
            <textarea id="qrf_final_system_directive" class="text_pole" rows="4"></textarea>
            <small class="notes">这段指令将与用户的输入和生成的`<plot>`模块组合，最终发送给酒馆AI。</small>
        </div>
    </fieldset>

    <div class="qrf_footer">
        <small class="notes">所有设置将在关闭此面板时自动保存。</small>
    </div>
</div>
